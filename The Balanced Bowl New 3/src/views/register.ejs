<!doctype html>
<html>
  <%- include('partials/head') %>
<body>
  <div class="container">
    <%- include('partials/header') %>

    <div class="card" style="max-width:520px;margin:18px auto">
      <h2>Sign up</h2>

      <form action="/register" method="post" enctype="multipart/form-data">

        <!-- Role Selection -->
        <div class="field">
          <label>Registering as</label>
          <select name="role" id="roleSelect">
            <option value="user">User</option>
            <option value="dietician">Dietician</option>
          </select>
        </div>

        <!-- Common Fields -->
        <div class="field">
          <label>Name</label>
          <input type="text" name="name" required>
        </div>

        <div class="field">
          <label>Email</label>
          <input type="email" name="email" required>
        </div>

        <div class="field">
          <label>Password</label>

          <!-- PASSWORD + EYE ICON -->
          <div class="password-wrapper" style="position:relative;">
            <input type="password" id="password" name="password" required style="padding-right:40px;">

            <span id="togglePassword"
                  style="position:absolute; right:10px; top:50%; transform:translateY(-50%);
                         cursor:pointer; font-size:18px;">
              üëÅÔ∏è
            </span>
          </div>

          <!-- LIVE PASSWORD RULES -->
          <ul id="password-rules" style="font-size:13px; margin-top:8px; color:#888; list-style:none; padding-left:0;">
            <li id="rule-lower">‚Ä¢ Lowercase letter</li>
            <li id="rule-upper">‚Ä¢ Uppercase letter</li>
            <li id="rule-number">‚Ä¢ Number</li>
            <li id="rule-special">‚Ä¢ Special character (!@#$%)</li>
            <li id="rule-length">‚Ä¢ At least 8 characters</li>
          </ul>

        </div>

        <!-- USER FIELDS -->
        <div id="userFields">
          <div class="field">
            <label>Phone</label>
            <input type="text" name="u_phone">
          </div>

          <div class="field">
            <label>Age</label>
            <input type="number" name="u_age">
          </div>

          <div class="field">
            <label>Height (cm)</label>
            <input type="number" name="u_height">
          </div>

          <div class="field">
            <label>Weight (kg)</label>
            <input type="number" name="u_weight">
          </div>

          <div class="field">
            <label>Bio</label>
            <textarea name="u_bio" placeholder="Tell us about your goals, lifestyle, habits..."></textarea>
          </div>
        </div>

        <!-- DIETICIAN FIELDS -->
        <div id="dieticianFields" style="display:none">

          <div class="field">
            <label>Phone</label>
            <input type="text" name="d_phone">
          </div>

          <!-- UPLOAD CERTIFICATES -->
          <div class="field">
            <label>Certificates (Upload files)</label>
            <input type="file"
                   name="d_certificates"
                   multiple
                   accept=".pdf,.jpg,.jpeg,.png">
            <small style="color:var(--muted)">Upload PDF or image certificates</small>
          </div>

          <div class="field">
            <label>Specialization (comma separated)</label>
            <input type="text" name="d_specialization" placeholder="e.g., Weight Loss, PCOD, Diabetes">
          </div>

          <div class="field">
            <label>Experience (years)</label>
            <input type="number" name="d_experienceYears">
          </div>

          <div class="field">
            <label>Fee (in Rs)</label>
            <input type="number" name="d_fee">
          </div>

          <div class="field">
            <label>Consultation Modes (comma separated)</label>
            <input type="text" name="d_modes" placeholder="online, in-person">
          </div>

          <div class="field">
            <label>Bio</label>
            <textarea name="d_bio" placeholder="Tell users about your expertise"></textarea>
          </div>

        </div>

        <button class="btn" style="margin-top:12px">Create account</button>
      </form>

      <!-- SCRIPT: ROLE SWITCH, PASSWORD TOGGLE, LIVE VALIDATION -->
      <script>
        // ------------------------ ROLE SWITCH ------------------------
        document.getElementById("roleSelect").addEventListener("change", function() {
          const role = this.value;
          document.getElementById("userFields").style.display = (role === "user") ? "block" : "none";
          document.getElementById("dieticianFields").style.display = (role === "dietician") ? "block" : "none";
        });

        // ------------------------ SHOW / HIDE PASSWORD ------------------------
        const pwdInput = document.getElementById("password");
        const toggle = document.getElementById("togglePassword");

        toggle.addEventListener("click", () => {
          const type = pwdInput.type === "password" ? "text" : "password";
          pwdInput.type = type;
          toggle.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
        });

        // ------------------------ LIVE PASSWORD CHECK ------------------------
        const rules = {
          lower: /[a-z]/,
          upper: /[A-Z]/,
          number: /[0-9]/,
          special: /[!@#$%^&*(),.?":{}|<>]/,
          length: /.{8,}/
        };

        const ruleIds = {
          lower: "rule-lower",
          upper: "rule-upper",
          number: "rule-number",
          special: "rule-special",
          length: "rule-length"
        };

        pwdInput.addEventListener("input", () => {
          const val = pwdInput.value;
          for (const key in rules) {
            const ok = rules[key].test(val);
            const el = document.getElementById(ruleIds[key]);
            el.style.color = ok ? "green" : "#888";
            el.style.fontWeight = ok ? "600" : "normal";
          }
        });
      </script>

    </div>

    <%- include('partials/footer') %>
  </div>
</body>
</html>
